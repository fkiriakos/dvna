version: 2.1
orbs:
  shiftleft: shiftleft/shiftleft@1.0.6

jobs:
  shiftleft:
    machine: true
    steps:
      - checkout
      - shiftleft/install
      - run:
          name: ShiftLeft SAST Analysis
          command: |
            sl analyze --wait --app dvna --tag branch=$CIRCLE_BRANCH --cpg --js . -- --exclude public/assets/ --ignore-minified
      - run:
          name: Check ShiftLeft Scan Results
          command: |
            sl check-analysis --app dvna --branch=$CIRCLE_BRANCH

workflows:
  version: 2.1
  run-sast-scan:
    jobs:
      - shiftleft
